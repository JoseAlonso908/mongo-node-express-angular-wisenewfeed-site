angular.module("er.controllers",[]).controller("startController",["$scope","$auth","$location","$cookies","$timeout","countriesListService","confirmAccountModal","validateEmailService","validatePhoneService","forgotPasswordModal","findMyAccountModal","identityService",function(e,t,r,n,o,i,a,s,c,u,l,d){e.identityLoading=!0,d().then(function(t){e.identityLoading=!0,e.user=t}),e.authenticate=function(e){n.remove("user"),t.logout(),t.authenticate(e).then(function(e){console.log("Done."),console.log(e),r.url("/")})["catch"](function(e){r.url("/start")})},e.login={email:"",password:"",error:""},e.remember=!1,e.doLogin=function(){t.login({email:e.login.email,password:e.login.password}).then(function(t){localStorage.rememberLogin=e.remember,r.url("/")})["catch"](function(t){e.login.error=t.data.message})},e.doneSignup=function(t){t&&(n.putObject("signup-params",e.signup),r.url("/confirmsignup"))},e.signup={email:"",password:"",name:"",country:"",phone:""},e.doSignup=function(){for(var t in e.signup)if("error"!==t&&!e.signup[t])return e.signup.error="All fields should be filled";async.series([function(t){s(e.signup.email).then(function(e){t()},function(e){t(e)})},function(t){c(e.signup.phone).then(function(e){t()},function(e){t(e)})}],function(t){t?e.signup.error=t:a.activate({$parent:e,phone:e.signup.phone})})},e.forgotPassword=function(){u.activate({$parent:e})},e.findMyAccount=function(){l.activate({$parent:e})},e.logout=function(){t.logout(),n.remove("user"),e.user=void 0},e.countries=[],i().then(function(t){e.countries=t})}]).controller("confirmSignupController",["$scope","$cookies","$auth","$location",function(e,t,r,n){e.fields=["Field 1","Field 2","Field 3","Field 4"],e.signup=t.getObject("signup-params"),e.extra={title:"",company:"",field:""},e.extraError={title:"",company:"",field:""},e.doSignup=function(t){var o=["expert","journalist","user"];if(-1===o.indexOf(t))return!1;if("expert"==t||"journalist"==t){var i=!1;for(var a in e.extra){var s=e.extra[a];s?e.extraError[a]=!1:(e.extraError[a]=!0,i=!0)}if(i)return!1;Object.assign(e.signup,{title:e.extra.title,company:e.extra.company})}e.signup.role=t,console.log(e.signup),r.signup(e.signup).then(function(e){n.url("/start")})["catch"](function(e){alert("Signup failed due to: "+e.data.message)})}}]).controller("homeController",["$scope","$timeout","categoriesDropdown","countriesDropdown","dropdowns","identityService","feedService",function(e,t,r,n,o,i,a){e.cats=r,e.countries=n,e.r_tags=["Tag 1","Tag 2","Tag 3","Tag 4","Tag 5"],e.r_people=["Guy 1","Guy 2","Guy 3","Guy 4","Guy 5","Guy 6","Guy 7"],e.r_categories=["Category 1","Category 2","Category 3","Category 4"],i().then(function(t){e.user=t,e.feedLoading=!0,e.feed=[],a.then(function(t){e.feed=t,e.feedLoading=!1,e.$apply()})})}]).controller("profileController",["$scope","identityService","feedService",function(e,t,r){e.wallpaperStyle={},t().then(function(t){e.user=t,e.user.wallpaper&&(e.wallpaperStyle={"background-image":"url("+t.wallpaper+")}"}),e.feedLoading=!0,e.feed=[],r.then(function(t){e.feed=t,e.feedLoading=!1,e.$apply()})})}]).controller("resetPasswordController",["$scope","$location","checkPasswordTokenService","resetPasswordService",function(e,t,r,n){e.newPassword="",e.newPasswordRepeat="",e.newPasswordError=!1,e.newPasswordRepeatError=!1;var o=location.hash.split("?")[1].split("token=")[1];r(o).then(function(t){e.tokenValid=!0},function(t){e.tokenValid=!1}),e.doReset=function(){return e.newPassword?e.newPassword!=e.newPasswordRepeat?e.newPasswordRepeatError=!0:void n(o,e.newPassword).then(function(e){t.url("/start")},function(t){e.customError=t,e.tokenValid=!1}):e.newPasswordError=!0}}]),angular.module("er.directives",[]).directive("avatar",function(){return{restrict:"E",templateUrl:"assets/views/directives/avatar.htm",scope:{image:"@",color:"@",number:"@"}}}).directive("post",function(){return{restrict:"E",templateUrl:"assets/views/directives/post.htm",scope:{post:"="},link:function(e,t,r){e.user=e.$parent.user}}}).directive("question",function(){return{restrict:"E",templateUrl:"assets/views/directives/question.htm",scope:{question:"="}}}).directive("familiarexpert",function(){return{restrict:"E",templateUrl:"assets/views/directives/familiar-expert.htm",scope:{user:"="}}}).directive("newquestions",["$timeout",function(e){return{restrict:"E",templateUrl:"assets/views/directives/new-questions.htm",scope:{user:"="},link:function(e,t,r){e.questions=e.user.questions}}}]).directive("familiarexperts",["$timeout","familiarExpertsService",function(e,t){return{restrict:"E",templateUrl:"assets/views/directives/familiar-experts.htm",link:function(e,r,n){e.users=[],e.familiarExpertsLoading=!0,t.then(function(t){e.users=t,e.familiarExpertsLoading=!1,e.$apply()})}}}]).directive("topbar",function(){return{restrict:"E",templateUrl:"assets/views/directives/topbar.htm",scope:{user:"="}}}).directive("filters",["dropdowns",function(e){return{restrict:"E",templateUrl:"assets/views/directives/filters.htm",link:function(t,r,n){e()}}}]).directive("bigratedavatar",function(){return{restrict:"E",templateUrl:"assets/views/directives/big-rated-avatar.htm",scope:{user:"="},link:function(e,t,r){var n=angular.element(t).find("canvas")[0],o=n.getContext("2d"),i=angular.element(t)[0].children[0].offsetWidth,a=angular.element(t)[0].children[0].offsetHeight;angular.element(t).find("canvas").attr("width",i),angular.element(t).find("canvas").attr("height",a);var s=4,c=e.user.xp/100*2+1.5;o.lineWidth=s,o.strokeStyle="#43abe7",o.beginPath(),o.arc(i/2,a/2,i/2-s/2,1.5*Math.PI,c*Math.PI,!1),o.stroke()}}}).directive("autosuggest",["$compile",function(e){return{restrict:"E",templateUrl:"assets/views/directives/autosuggest.htm",scope:{suggestions:"=",ngModel:"="},link:function(e,t,r){e.show=!1;var n;e.$watch("ngModel",function(t,r){if(t&&t!=r&&r!=n){e.filteredSuggestions=[];for(var o=0;o<e.suggestions.length;o++){var i=e.suggestions[o];-1!==i.toLowerCase().indexOf(t.toLowerCase())&&e.filteredSuggestions.push(i)}e.filteredSuggestions=e.filteredSuggestions.slice(0,7),e.show=!0}else e.show=!1}),e.setSuggestion=function(t){n=e.ngModel,e.ngModel=t,e.show=!1}}}}]),angular.module("er.modals",[]).factory("confirmAccountModal",["btfModal",function(e){return e({controller:"confirmAccountModalController",controllerAs:"modal",templateUrl:"assets/views/modals/confirm-account.htm"})}]).controller("confirmAccountModalController",["$scope","$parent","phone","confirmAccountModal","verifyPhoneService","verifyPhoneCodeService",function(e,t,r,n,o,i){e.ready=!1,e.phone=r,o(r).then(function(){console.log("Code sent;"),e.ready=!0}),e.close=function(){n.deactivate(),t.doneSignup(!1)},e.confirm=function(){return e.code?(e.loading=!0,void i(r,e.code).then(function(r){e.loading=!1,n.deactivate(),t.doneSignup(!0),console.log(r)},function(t){e.loading=!1,e.codeError=!0,console.log(t)})):e.codeError=!0},e.resend=function(){}}]).factory("forgotPasswordModal",["btfModal",function(e){return e({controller:"forgotPasswordModalController",controllerAs:"modal",templateUrl:"assets/views/modals/forgot-password.htm"})}]).controller("forgotPasswordModalController",["$scope","$parent","forgotPasswordModal","forgotPasswordService",function(e,t,r,n){e.close=r.deactivate,e.confirm=function(){return e.emailError=!1,e.email?(e.loading=!0,void n(e.email).then(function(t){e.loading=!1,e.sent=!0},function(t){e.loading=!1,e.error=t})):e.emailError=!0}}]).factory("findMyAccountModal",["btfModal",function(e){return e({controller:"findMyAccountModalController",controllerAs:"modal",templateUrl:"assets/views/modals/find-my-account.htm"})}]).controller("findMyAccountModalController",["$scope","$parent","$location","findMyAccountModal","findAccountRequestService","findAccountSigninService",function(e,t,r,n,o,i){e.close=n.deactivate,e.confirm=function(){return e.error="",e.inputError=!1,e.input?(e.requestLoading=!0,void o(e.input).then(function(t){e.requestLoading=!1,e.codeSent=!0},function(t){e.requestLoading=!1,e.error=t,console.error(t)})):e.inputError=!0},e.signIn=function(){return e.codeValidationError="",e.codeError=!1,e.code?(e.codeLoading=!0,void i(e.code).then(function(t){e.codeLoading=!1,r.url("/"),window.localStorage.satellizer_token=t.token,n.deactivate()},function(t){e.codeLoading=!1,e.codeValidationError=t})):e.codeError=!0}}]),angular.module("er.services",[]).factory("findAccountRequestService",["$http","$q",function(e,t){return function(r){var n=t.defer();return e.post("/auth/findaccount/request",{value:r}).then(function(e){n.resolve(e.data)},function(e){n.reject(e.data.message)}),n.promise}}]).factory("findAccountSigninService",["$http","$q",function(e,t){return function(r){var n=t.defer();return e.post("/auth/findaccount/signin",{code:r}).then(function(e){n.resolve(e.data)},function(e){n.reject(e.data.message)}),n.promise}}]).factory("forgotPasswordService",["$http","$q",function(e,t){return function(r){var n=t.defer();return e.post("/auth/forgotpassword",{email:r}).then(function(e){n.resolve(e.data)},function(e){n.reject(e.data.message)}),n.promise}}]).factory("checkPasswordTokenService",["$http","$q",function(e,t){return function(r){var n=t.defer();return e.post("/auth/forgotpassword/validate",{token:r}).then(function(e){n.resolve(e.data)},function(e){n.reject(e.data.message)}),n.promise}}]).factory("resetPasswordService",["$http","$q",function(e,t){return function(r,n){var o=t.defer();return e.post("/auth/resetpassword",{token:r,newpassword:n}).then(function(e){o.resolve(e.data)},function(e){o.reject(e.data.message)}),o.promise}}]).factory("validateEmailService",["$http","$q",function(e,t){return function(r){var n=t.defer();return e.post("/auth/signup/validate/email",{email:r}).then(function(e){n.resolve(e.data)},function(e){n.reject(e.data.message)}),n.promise}}]).factory("validatePhoneService",["$http","$q",function(e,t){return function(r){var n=t.defer();return e.post("/auth/signup/validate/phone",{phone:r}).then(function(e){n.resolve(e.data)},function(e){n.reject(e.data.message)}),n.promise}}]).factory("verifyPhoneService",["$http","$q",function(e,t){return function(r){var n=t.defer();return e.post("/auth/signup/verify/phone",{phone:r}).then(function(e){n.resolve(e.data)},function(e){n.reject(e.data.message)}),n.promise}}]).factory("verifyPhoneCodeService",["$http","$q",function(e,t){return function(r,n){var o=t.defer();return e.post("/auth/signup/verifycode/phone",{phone:r,code:n}).then(function(e){o.resolve(e.data)},function(e){o.reject(e.data.message)}),o.promise}}]).factory("countriesListService",["$http","$q",function(e,t){return function(){var r=t.defer();return e.get("/static/countries").then(function(e){r.resolve(e.data)}),r.promise}}]).factory("identityService",["$timeout","$http","$cookies","$auth","$q",function(e,t,r,n,o){return function(){var e=o.defer(),i=r.getObject("user");return i&&e.resolve(i),t.get("/me",{header:{authorization:n.getToken()}}).then(function(t){var n=t.data;n.rating=n.rating||1,n.color=n.color||"bronze",n.likes=n.likes||0,n.xp=n.xp||0,n.dislikes=n.dislikes||0,n.reactions=n.reactions||0,n.followers=n.followers||0,n.following=n.following||0,n.avatar=n.avatar||"/assets/images/avatar_placeholder.png",n.role=n.role.charAt(0).toUpperCase()+n.role.slice(1);var o={expires:new Date};localStorage.rememberLogin&&(o.expires=new Date(Date.now()+6048e5)),r.putObject("user",n,o),e.resolve(n)}),e.promise}}]).factory("feedService",["$timeout","$sce","parseTextService",function(e,t,r){return new Promise(function(n,o){var i=[{id:1,author:{name:"Nicholas Cage",avatar:"https://s.aolcdn.com/hss/storage/midas/627f1d890718ff2c58318a280145a153/203216448/nicholas-cage-con-air.jpg",rating:1,color:"gold",position:"Director",country:"United States"},createdAt:new Date(Date.now()-1e3*Math.round(1e3*Math.random())),text:"@SomeGuy Lorem ipsum dolor sit amet, neglegentur vituperatoribus cum ei. Facete dolorum aliquando duo ne, pro an delenit praesentea perpetua adipisc eos, civibus.",image:"https://s.aolcdn.com/hss/storage/midas/627f1d890718ff2c58318a280145a153/203216448/nicholas-cage-con-air.jpg",ratings:{expert:{likes:12432,dislikes:4230,shares:1320},journalist:{likes:12432,dislikes:4230,shares:1320},visitor:{likes:12432,dislikes:4230,shares:1320}},comments:[{id:2,author:{name:"Nicholas Cage",avatar:"https://s.aolcdn.com/hss/storage/midas/627f1d890718ff2c58318a280145a153/203216448/nicholas-cage-con-air.jpg",rating:2,color:"silver",position:"Director",country:"United States"},createdAt:new Date(Date.now()-1e3*Math.round(1e3*Math.random())),text:"Lorem ipsum dolor sit amet, neglegentur vituperatoribus cum ei. Facete dolorum aliquando! #DieHard",likes:12,dislikes:1}]},{id:2,author:{name:"Nicholas Cage",avatar:"https://s.aolcdn.com/hss/storage/midas/627f1d890718ff2c58318a280145a153/203216448/nicholas-cage-con-air.jpg",rating:1,color:"gold",position:"Director",country:"United States"},createdAt:new Date(Date.now()-1e3*Math.round(1e3*Math.random())),text:"Lorem ipsum dolor sit amet, neglegentur vituperatoribus cum ei. Facete dolorum aliquando duo ne, pro an delenit praesentea perpetua adipisc eos, civibus.",image:"https://s.aolcdn.com/hss/storage/midas/627f1d890718ff2c58318a280145a153/203216448/nicholas-cage-con-air.jpg",ratings:{expert:{likes:12432,dislikes:4230,shares:1320},journalist:{likes:12432,dislikes:4230,shares:1320},visitor:{likes:12432,dislikes:4230,shares:1320}}},{id:3,author:{name:"John Lennon",avatar:"https://s.aolcdn.com/hss/storage/midas/627f1d890718ff2c58318a280145a153/203216448/nicholas-cage-con-air.jpg",rating:1,color:"silver",position:"Singer",country:"United Kingdom"},createdAt:new Date(Date.now()-1e3*Math.round(1e3*Math.random())),text:"Lorem ipsum dolor sit amet, neglegentur vituperatoribus cum ei. Facete dolorum aliquando duo ne, pro an delenit praesentea perpetua adipisc eos, civibus.",ratings:{expert:{likes:12432,dislikes:4230,shares:1320},journalist:{likes:12432,dislikes:4230,shares:1320},visitor:{likes:12432,dislikes:4230,shares:1320}}}];for(var a in i){var s=i[a];if(s.ratings.expert.likes=numeral(s.ratings.expert.likes).format("0a").toUpperCase(),s.ratings.expert.dislikes=numeral(s.ratings.expert.dislikes).format("0a").toUpperCase(),s.ratings.expert.shares=numeral(s.ratings.expert.shares).format("0a").toUpperCase(),s.ratings.journalist.likes=numeral(s.ratings.journalist.likes).format("0a").toUpperCase(),s.ratings.journalist.dislikes=numeral(s.ratings.journalist.dislikes).format("0a").toUpperCase(),s.ratings.journalist.shares=numeral(s.ratings.journalist.shares).format("0a").toUpperCase(),s.ratings.visitor.likes=numeral(s.ratings.visitor.likes).format("0a").toUpperCase(),s.ratings.visitor.dislikes=numeral(s.ratings.visitor.dislikes).format("0a").toUpperCase(),s.ratings.visitor.shares=numeral(s.ratings.visitor.shares).format("0a").toUpperCase(),s.text=t.trustAsHtml(r(s.text)),s.comments)for(var c in s.comments){var u=s.comments[c];u.text=t.trustAsHtml(r(u.text)),s.comments[c]=u}i[a]=s}e(function(){n(i)},500)})}]).factory("familiarExpertsService",["$timeout",function(e){return new Promise(function(t,r){var n=[{id:1,name:"Keanu Reeves",role:"Expert",image:"https://s.aolcdn.com/hss/storage/midas/627f1d890718ff2c58318a280145a153/203216448/nicholas-cage-con-air.jpg",color:"bronze",rating:2,likes_percentage:70},{id:2,name:"Keanu Reeves",role:"Expert",image:"https://s.aolcdn.com/hss/storage/midas/627f1d890718ff2c58318a280145a153/203216448/nicholas-cage-con-air.jpg",color:"bronze",rating:2,likes_percentage:70},{id:3,name:"Keanu Reeves",role:"Expert",image:"https://s.aolcdn.com/hss/storage/midas/627f1d890718ff2c58318a280145a153/203216448/nicholas-cage-con-air.jpg",color:"bronze",rating:2,likes_percentage:70}];e(function(){t(n)},400)})}]).factory("dropdowns",function(){return function(){var e=angular.element(document.querySelectorAll(".menu-buttons.dropdown")),t=angular.element(document.querySelectorAll(".dropdown-list")),r=angular.element(document.body);r.on("click",function(){t.removeClass("active")}),e.on("click",function(e){e.stopImmediatePropagation();var t=angular.element(this).attr("dropdown-id");angular.element(document.querySelector('.dropdown-list[dropdown-id="'+t+'"]')).toggleClass("active")})}}).factory("categoriesDropdown",function(){var e=(angular.element(document.querySelector(".menu-buttons.dropdown[dropdown-id=categories]")),angular.element(document.querySelector(".dropdown-list[dropdown-id=categories]")));e.on("click",function(e){e.stopImmediatePropagation()});var t={};t.categories=[{id:1,title:"World News",count:353478392},{id:2,title:"Canada News",count:12478392},{id:3,title:"Buzz News",count:4478392},{id:4,title:"Science",count:2478392},{id:5,title:"Business",count:532952},{id:6,title:"Health",count:422321},{id:7,title:"Technology",count:352210},{id:8,title:"Sport",count:24990},{id:9,title:"Entertainment",count:1224}],t.chosenCategory=t.categories[1],t.activeCategoryClass=function(e){return{active:e.id===t.chosenCategory.id}},t.setActiveCategory=function(r){t.chosenCategory=r,e.removeClass("active")};for(var r in t.categories)t.categories[r].countShort=numeral(t.categories[r].count).format("0a").toUpperCase();return t}).factory("countriesDropdown",function(){var e=(angular.element(document.querySelector(".menu-buttons.dropdown[dropdown-id=countries]")),angular.element(document.querySelector(".dropdown-list[dropdown-id=countries]")));e.on("click",function(e){e.stopImmediatePropagation()});var t={};return t.countries=[{id:1,title:"North America",sub:[{id:2,title:"United States"},{id:3,title:"Canada"},{id:4,title:"Mexico"}]},{id:5,title:"Central & South America",sub:[{id:6,title:"Brazil"},{id:7,title:"Chile"},{id:8,title:"Argentina"}]}],t.chosenCountry=t.countries[0].sub[0],t.activeRegionClass=function(e){var r=!1;for(var n in e.sub)e.sub[n].id===t.chosenCountry.id&&(r=!0);return{active:r}},t.activeCountryClass=function(e){return{active:t.chosenCountry.id===e.id}},t.setActiveCountry=function(r){t.chosenCountry=r,e.removeClass("active")},t}).factory("parseTextService",function(){return function(e,t){return t||(t={tags:[],people:[],cats:[]}),e=e.replace(/#([a-z0-9]+)/gi,'<a href="#!/tag/$1" class="'+t.tags.join(" ")+'">#$1</a>'),e=e.replace(/@([a-z0-9]+)/gi,'<a href="#!/people/$1" class="'+t.people.join(" ")+'">@$1</a>'),e=e.replace(/\$([a-z0-9]+)/gi,'<a href="#!/category/$1" class="'+t.cats.join(" ")+'">$$1</a>')}});