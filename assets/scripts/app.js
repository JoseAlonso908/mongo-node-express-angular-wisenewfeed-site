var sequence="";angular.element(document).on("keydown",function(e){if(e.stopImmediatePropagation(),sequence+=e.key,"yapidor"===sequence.toLowerCase()){angular.element(document.body).css("fontFamily","Comic Sans MS");for(var t=document.querySelectorAll("*"),n=0;n<t.length;n++)angular.element(t[n]).css("color",["red","blue","green","yellow","purple"][Math.round(5*Math.random())]),angular.element(t[n]).css("backgroundColor",["red","blue","green","yellow","purple"][Math.round(5*Math.random())]);sequence=""}}),angular.module("er.controllers",[]).controller("startController",["$scope","$auth","$location","$cookies","$timeout","countriesListService","confirmAccountModal","validateEmailService","validatePhoneService","forgotPasswordModal","findMyAccountModal","identityService",function(e,t,n,o,r,i,a,c,u,s,l,d){e.identityLoading=!0,d.get().then(function(t){return e.identityLoading=!1,e.user=t,n.url("/")}),e.goHome=function(){e.user&&n.url("/")},e.authenticate=function(o){t.logout(),t.authenticate(o).then(function(t){d.get().then(function(t){e.user=t,n.url("/")})})["catch"](function(e){n.url("/start")})},e.login={email:"",password:"",error:""},e.remember=!1,e.doLogin=function(){e.login.email&&e.login.password&&t.login({email:e.login.email,password:e.login.password}).then(function(t){localStorage.rememberLogin=e.remember,n.url("/")})["catch"](function(t){e.login.error=t.data.message})},e.doneSignup=function(t){t&&(o.putObject("signup-params",e.signup),n.url("/confirmsignup"))},e.signup={email:"",password:"",name:"",country:"",phone:""},e.doSignup=function(){for(var t in e.signup)"error"!==t&&(!e.signup[t]||"country"==t&&!e.signup.country.code)&&(angular.element(document.querySelector("form[name=signupForm] [name="+t+"]")).triggerHandler("blur"),e.signup.error="Please, check highlighted with red fields",e.signupForm.$valid=!1,"country"===t&&angular.element(document.querySelector("form[name=signupForm] [name="+t+"]")).removeClass("ng-valid").addClass("ng-invalid"));e.signupForm.$valid&&async.series([function(t){c(e.signup.email).then(function(e){t()},function(e){t(e)})},function(t){u("+"+e.signup.country.code+e.signup.phone).then(function(e){t()},function(e){t(e)})}],function(t){t?e.signup.error=t:a.activate({$parent:e,phone:"+"+e.signup.country.code+e.signup.phone})})},e.forgotPassword=function(){s.activate({$parent:e})},e.findMyAccount=function(){l.activate({$parent:e})},e.logout=function(){t.logout(),e.user=void 0},e.countries=[],i().then(function(t){e.countries=t})}]).controller("confirmSignupController",["$scope","$cookies","$auth","$location","fieldsListService",function(e,t,n,o,r){r.get().then(function(t){for(var n in t)0!=t[n].count&&(t[n].additional=numeral(t[n].count).format("0a").toUpperCase());e.fields=t.map(function(e){return e.title})}),e.signup=t.getObject("signup-params"),e.signup.phone="+"+e.signup.country.code+e.signup.phone,e.signup.country=e.signup.country.country,e.extra={title:"",company:"",field:""},e.extraError={title:"",company:"",field:""},e.doSignup=function(t){var r=["expert","journalist","user"];if(-1===r.indexOf(t))return!1;if("expert"==t||"journalist"==t){var i=!1;for(var a in e.extra){var c=e.extra[a];c?e.extraError[a]=!1:(e.extraError[a]=!0,i=!0)}if(i)return!1;Object.assign(e.signup,{position:e.extra.title,company:e.extra.company,field:e.extra.field})}e.signup.role=t,n.signup(e.signup).then(function(e){localStorage.satellizer_token=e.data.token,o.url("/")})["catch"](function(e){alert("Signup failed due to: "+e.data.message)})}}]).controller("homeController",["$scope","$rootScope","$timeout","fieldsListService","groupedCountriesService","identityService",function(e,t,n,o,r,i){o.get().then(function(t){for(var n in t)0!=t[n].count&&(t[n].additional=numeral(t[n].count).format("0a").toUpperCase());t.unshift({id:0,title:"All"}),e.categories=t,e.chosenCategory=t[0]}),e.setActiveCategory=function(n){e.chosenCategory=n,t.$emit("feedCategory",n)},r.get().then(function(t){t.unshift({id:0,title:"All"}),e.countries=t,e.chosenCountry=t[0]}),e.setActiveCountry=function(n){e.chosenCountry=n,t.$emit("feedCountry",n)},i.get().then(function(t){n(function(){e.user=t,n.cancel(this)},0)})}]).controller("profileController",["$scope","$location","identityService",function(e,t,n){e.feedType="feed",n.get().then(function(t){e.user=t,e.profile=t})}]).controller("profileFeedController",["$routeParams","$scope","identityService",function(e,t,n){t.type=e.type,t.feedType="feed",t.id=e.id,async.parallel([function(){n.get().then(function(e){t.user=e})},function(){n.getOther(t.id).then(function(e){t.profile=e})}])}]).controller("profilePeopleController",["$routeParams","$scope","identityService","followService",function(e,t,n,o){t.type=e.type,t.feedType="people",t.id=e.id,async.parallel([function(){n.get().then(function(e){t.user=e})},function(){n.getOther(t.id).then(function(e){t.profile=e})},function(){o[t.type](t.id).then(function(e){t.people=e,"following"==t.type&&(t.people=t.people.map(function(e){return e.isFollowing=!0,e}))})}])}]).controller("personController",["$routeParams","$scope","$location","identityService","followService",function(e,t,n,o,r){o.get().then(function(n){o.getOther(e.id).then(function(e){t.user=n,t.profile=e,r.isFollowing(t.profile._id).then(function(e){t.profile.isFollowing=e})})}),t.follow=function(e){r.follow(t.profile._id).then(function(e){t.profile.isFollowing=e})},t.unfollow=function(e){r.unfollow(t.profile._id).then(function(e){t.profile.isFollowing=e})}}]).controller("editProfileController",["$scope","$location","$cookies","$timeout","identityService","uploadAvatarService","uploadWallpaperService","certificatesService","downloadsService","updateProfileService",function(e,t,n,o,r,i,a,c,u,s){e.wallpaperStyle={},e.saving=!1,e.saveChanges=function(){e.saving||e.profileForm.$valid&&(e.saving=!0,s(e.user.contact,e.user.experience,e.user.intro,e.user.name,e.user.position).then(function(){r.get(!0).then(function(n){e.user=n,e.saving=!1,t.url("/my")})})["catch"](function(t){e.saving=!1}))},e.changeAvatar=function(t){return"image"!=t.type.split("/")[0]?alert("You can upload only images"):void i(t).then(function(t){r.get(!0).then(function(t){e.user=t})})["catch"](function(e){alert("Can't upload avatar. File size should not exceed 5 megabytes.")})},e.changeWallpaper=function(){var t=document.querySelector("input[type=file][name=wallpaper]");angular.element(t).on("change",function(t){t.stopImmediatePropagation(),e.$apply(function(){var n=t.target.files[0];return"image"!=n.type.split("/")[0]?alert("You can upload only images"):void a(n).then(function(t){r.get(!0).then(function(t){e.user=t})})["catch"](function(e){alert("Can't upload wallpaper. File size should not exceed 5 megabytes.")})})}),o(function(){t.click(),o.cancel(this)},0)},e.attachCertificate=function(){var t=document.querySelector("input[type=file][name=certificate]");angular.element(t).on("change",function(t){t.stopImmediatePropagation(),e.$apply(function(){var n=t.target.files[0];c.add(n).then(function(t){r.get(!0).then(function(t){e.user.certificates=t.certificates})})["catch"](function(e){alert("Error while uploading file. File size should be lower than 5 megabytes.")})})}),o(function(){t.click()},0)},e.removeCertificate=function(t){c.remove(t).then(function(t){r.get(!0).then(function(t){e.user.certificates=t.certificates})})["catch"](function(e){})},e.attachDownload=function(){var t=document.querySelector("input[type=file][name=download]");angular.element(t).on("change",function(t){t.stopImmediatePropagation(),e.$apply(function(){var n=t.target.files[0];u.add(n).then(function(t){r.get(!0).then(function(t){e.user.downloads=t.downloads})})["catch"](function(e){alert("Error while uploading file. File size should be lower than 5 megabytes.")})})}),o(function(){t.click(),o.cancel(this)},0)},e.removeDownload=function(t){u.remove(t).then(function(t){r.get(!0).then(function(t){e.user.downloads=t.downloads})})["catch"](function(e){})},e.addExperience=function(){e.user.experience.push({time:"",place:"",description:""})},e.removeExperience=function(t){for(var n=e.user.experience,o=0;o<n.length;o++)JSON.stringify(n[o])==JSON.stringify(t)&&delete n[o];e.user.experience=[];for(var o=0;o<n.length;o++)n[o]&&e.user.experience.push(n[o])},r.get().then(function(t){e.user=t,e.user.wallpaper&&(e.wallpaperStyle={"background-image":"url("+t.wallpaper+")}"})})}]).controller("resetPasswordController",["$scope","$location","checkPasswordTokenService","resetPasswordService",function(e,t,n,o){e.newPassword="",e.newPasswordRepeat="",e.newPasswordError=!1,e.newPasswordRepeatError=!1;var r=location.hash.split("?")[1].split("token=")[1];n(r).then(function(t){e.tokenValid=!0},function(t){e.tokenValid=!1}),e.doReset=function(){return e.resetpasswordForm.$valid?e.newPassword?e.newPassword!=e.newPasswordRepeat?e.newPasswordRepeatError=!0:void o(r,e.newPassword).then(function(t){e.done=!0},function(t){e.customError=t,e.tokenValid=!1}):e.newPasswordError=!0:void 0}}]).controller("settingsController",["$scope","$location","$auth","identityService","countriesListService","fieldsListService","confirmPhoneModal",function(e,t,n,o,r,i,a){e.pages=["general","password","notifications"],e.activePage="general",e.connect=function(t){n.authenticate(t,{updateExisting:e.user._id}).then(function(t){o.get(!0).then(function(t){e.user=t})})["catch"](function(e){alert(e.data.message),console.error(e)})},e.disconnect=function(t){o.disconnectSocial(t).then(function(t){o.get(!0).then(function(t){e.user=t})},function(e){alert("Unable to disconnect social network profile. Please, try again later.")})},e.turnAllOff=function(){for(var t in e.user.notifications)e.user.notifications[t]=!1},e.savingFuncs={general:function(n){n.preventDefault();var r={name:n.target.name.value,email:n.target.email.value,phone:n.target.phone.value,country:n.target.country.value,field:n.target.field.value,language:n.target.language.value};if(e.profileSettings.$valid){var i=function(e){e&&o.updateSettings(r).then(function(e){return t.url("/my")},function(e){alert("Failed to update settings. Please, try again later.")})};r.phone==e.user.phone?i(!0):a.activate({$parent:e,phone:r.phone,callback:i})}},password:function(n){n.preventDefault();var r={oldPassword:e.oldPassword,newPassword:e.newPassword};e.changePassword.$valid&&!e.changePassword.$pristine&&o.isPasswordValid(r.oldPassword).then(function(n){return n?e.newPassword!=e.newPasswordRepeat?e.changePassword.newPasswordRepeat.$setValidity("required",!1):void o.updatePassword(e.oldPassword,e.newPassword).then(function(e){return t.url("/my")},function(e){console.error(e),alert("Unable to update password. Please, try again later.")}):e.changePassword.oldPassword.$setValidity("required",!1)})},notifications:function(n){n.preventDefault();var r=e.user.notifications;o.updateNotifications(r).then(function(e){return t.url("/my")},function(e){console.error(e),alert("Unable to update password. Please, try again later.")})}},async.parallel([function(){o.get().then(function(t){e.user=t})},function(){r().then(function(t){e.countries=t.map(function(e){return e.country})})},function(){i.get().then(function(t){e.fields=t})}],function(){e.$apply()})}]),angular.module("er.directives",[]).directive("dropdown",function(){return{restrict:"E",templateUrl:"assets/views/directives/dropdown.htm",scope:{title:"@",defaultItem:"=",list:"=",chosen:"=",change:"="},link:function(e,t,n){var o=angular.element(t)[0],r=angular.element(o.querySelector(".dropdown")),i=angular.element(o.querySelector(".dropdown-list"));dropdownLists=angular.element(document.querySelectorAll(".dropdown-list")),angular.element(document.body).on("click",function(e){i.removeClass("active")}),i.on("click",function(e){e.stopImmediatePropagation()}),i.on("mouseleave",function(e){dropdownLists.removeClass("active")}),r.on("click",function(e){dropdownLists.removeClass("active"),e.stopImmediatePropagation(),i.toggleClass("active"),angular.element(document.body).triggerHandler("shadow-click")}),e.isActiveParentItem=function(t){for(var n in t.sub)if(t.sub[n].id===e.chosen.id)return!0},e.isActiveItem=function(t){return e.chosen.id==t.id},e.choose=function(t){e.change(t),i.removeClass("active")}}}}).directive("usermenu",["$auth","$rootScope","$cookies","$location","identityService",function(e,t,n,o,r){return{restrict:"E",templateUrl:"assets/views/directives/usermenu.htm",scope:{user:"="},link:function(t,i,a){t.logout=function(){n.remove("user"),n.remove("token"),e.logout(),r.clean(),o.url("/start")},t.$on("open-user-menu",function(e,n){t.active=!0}),angular.element(document.body).on("click shadow-click",function(){t.active=!1,t.$apply()})}}}]).directive("avatar",["$rootScope",function(e){return{restrict:"E",templateUrl:"assets/views/directives/avatar.htm",scope:{user:"="},link:function(e,t,n){e.number=e.user.rating||1,e.color=e.user.color||"bronze",e.image=e.user.avatar||"/assets/images/avatar_placeholder.png",e.role=e.user.role||"User"}}}]).directive("onyourmind",["$rootScope","$timeout","postService",function(e,t,n){return{restrict:"E",templateUrl:"assets/views/directives/onyourmind.htm",link:function(e,o,r){e.files=[],e.create=function(){if(!e.loading){e.loading=!0;var t=e.files.map(function(e){return e.fileObject}),o=function(){};n.create(e.text,t,o).then(function(t){e.$parent.$apply(function(){e.text="",e.files=[],e.$parent.$emit("reloadfeed"),e.loading=!1})})["catch"](function(t){console.error(t),e.loading=!1})}},e.addImage=function(){if(!e.loading){var n=o[0].querySelector("input[type=file]");angular.element(n).on("change",function(t){t.stopImmediatePropagation();var n=new FileReader,o=t.target.files[0];-1!==["image/jpeg","image/png"].indexOf(o.type)&&(n.addEventListener("load",function(){e.$apply(function(){e.files.push({base64:n.result,fileObject:o}),angular.element(t.target).parent()[0].reset()})}),n.readAsDataURL(o))}),t(function(){n.click(),t.cancel(this)},0)}},e.removeUpload=function(t){e.loading||(e.files=e.files.filter(function(e,n){return t==n?!1:!0}))},angular.element(o[0].querySelector("textarea")).on("keyup keypress",function(e){var t=e.target.value,n=t.split(/\n/).length,o=parseInt(window.getComputedStyle(e.target).paddingTop),r=parseInt(window.getComputedStyle(e.target).paddingBottom);n>3?angular.element(e.target).css("height",16*(n+1)+(o+r+2)+"px"):angular.element(e.target).css("height","")})}}}]).directive("profilereactions",function(){return{restrict:"E",templateUrl:"assets/views/directives/profilereactions.htm",scope:{active:"=",profile:"="}}}).directive("aboutbox",function(){return{restrict:"E",templateUrl:"assets/views/directives/aboutbox.htm"}}).directive("feed",["$rootScope","feedService","commentService",function(e,t,n){return{restrict:"E",templateUrl:"assets/views/directives/feed.htm",scope:{type:"=",id:"=",user:"="},link:function(n,o,r){n.lastCategory=void 0,n.lastCountry=void 0,n.$parent.$on("reloadfeed",function(){i()}),e.$on("feedCategory",function(e,t){0===t.id?n.lastCategory=void 0:n.lastCategory=t.title,i()}),e.$on("feedCountry",function(e,t){0===t.id?n.lastCountry=void 0:n.lastCountry=t.title,i()});var i=function(){var o="all";if(e.user||(o="all"),n.type)n.feedLoading=!0,n.feed=[],t.reacted(n.id,n.type).then(function(e){n.feedLoading=!1,n.feed=e});else{n.feedLoading=!0,n.feed=[];var r=[n.lastCategory,n.lastCountry];n.user&&r.push(n.user._id),t.feed.apply(t,r).then(function(e){n.feedLoading=!1,n.feed=e})}};i()}}}]).directive("post",["$timeout","postService","commentService","reactionsService","followService",function(e,t,n,o,r){return{restrict:"E",templateUrl:"assets/views/directives/post.htm",scope:{post:"=",user:"="},link:function(i,a,c){angular.element(document.body).on("click",function(){i.post.menu=!1}),r.isFollowing(i.post.author._id).then(function(e){i.post.author.isFollowing=e}),i.follow=function(e){r.follow(e.author._id).then(function(e){i.post.author.isFollowing=e})},i.unfollow=function(e){r.unfollow(e.author._id).then(function(e){i.post.author.isFollowing=e})},i.files=[],i.addComment=function(e){if(!i.loading){i.loading=!0;var t=i.files.map(function(e){return e.fileObject});n.add(e._id,e.commentText,t).then(function(){e.commentText="",i.files=[],i.$emit("reloadcomments",e._id),i.loading=!1},function(){i.loading=!1})}},i.addImage=function(){if(!i.loading){var t=a[0].querySelector("input[type=file]");angular.element(t).on("change",function(e){e.stopImmediatePropagation();var t=new FileReader,n=e.target.files[0];-1!==["image/jpeg","image/png"].indexOf(n.type)&&(t.addEventListener("load",function(){i.$apply(function(){i.files.push({base64:t.result,fileObject:n}),angular.element(e.target).parent()[0].reset()})}),t.readAsDataURL(n))}),e(function(){t.click(),e.cancel(this)},0)}},i.react=function(e,t,n){var r="react";n&&(r="unreact"),o[r](e._id,t).then(function(t){i.$emit("reloadreactions",e._id)},function(e){console.log("Reaction failed"),console.log(e)})},i.removePost=function(e){t.remove(e._id).then(function(){i.$parent.$emit("reloadfeed")},function(){alert("Unable to remove post. Please, try again later.")})}}}}]).directive("postreactions",["$rootScope","reactionsService",function(e,t){return{restrict:"E",templateUrl:"assets/views/directives/postreactions.htm",scope:{post:"="},link:function(e,n,o){e.reactions={expert:{likes:0,dislikes:0,shares:0},journalist:{likes:0,dislikes:0,shares:0},user:{likes:0,dislikes:0,shares:0}};var r=function(){t.get(e.post._id).then(function(t){e.post.youdid=t.youdid;var n=t.reactions;n.expert.likes=numeral(n.expert.likes).format("0a").toUpperCase(),n.expert.dislikes=numeral(n.expert.dislikes).format("0a").toUpperCase(),n.expert.shares=numeral(n.expert.shares).format("0a").toUpperCase(),n.journalist.likes=numeral(n.journalist.likes).format("0a").toUpperCase(),n.journalist.dislikes=numeral(n.journalist.dislikes).format("0a").toUpperCase(),n.journalist.shares=numeral(n.journalist.shares).format("0a").toUpperCase(),n.user.likes=numeral(n.user.likes).format("0a").toUpperCase(),n.user.dislikes=numeral(n.user.dislikes).format("0a").toUpperCase(),n.user.shares=numeral(n.user.shares).format("0a").toUpperCase(),e.reactions=n,e.$apply()},function(e){console.error(e)})};r(),e.$parent.$on("reloadreactions",function(t,n){n==e.post._id&&r()})}}}]).directive("postcomments",["postService",function(e){return{restrict:"E",templateUrl:"assets/views/directives/postcomments.htm",scope:{post:"="},link:function(t,n,o){t.showmore=!1,t.comments=[],t.$parent.$on("reloadcomments",function(e,t){r()});var r=function(){e.getComments(t.post._id).then(function(e){t.comments=e,t.$parent.commentsCount=t.comments.length,t.$apply()})};r()}}}]).directive("commentreactions",["$rootScope","commentReactionsService",function(e,t){return{restrict:"E",templateUrl:"assets/views/directives/commentreactions.htm",scope:{comment:"="},link:function(e,n,o){var r=function(){t.get(e.comment._id).then(function(t){e.comment.youdid=t.youdid;var n=t.reactions;n.likes=numeral(n.likes).format("0a").toUpperCase(),n.dislikes=numeral(n.dislikes).format("0a").toUpperCase(),e.reactions=n,e.$apply()},function(e){console.error(e)})};r(),e.$parent.$on("reloadcommentreactions",function(t,n){n==e.comment._id&&r()}),e.react=function(n,o,r){var i="react";r&&(i="unreact"),t[i](n._id,o).then(function(t){e.$emit("reloadcommentreactions",n._id)},function(e){console.log("Reaction failed"),console.log(e)})}}}}]).directive("person",["followService",function(e){return{restrict:"E",templateUrl:"assets/views/directives/person.htm",scope:{person:"="},link:function(t,n,o){angular.element(document.body).on("click",function(){t.person.menu=!1,t.$apply()}),t.person.role=t.person.role[0].toUpperCase()+t.person.role.substr(1),"undefined"==typeof t.person.isFollowing&&e.isFollowing(t.person._id).then(function(e){t.person.isFollowing=e}),t.toggleFollow=function(n){n.isFollowing?e.unfollow(n._id).then(function(e){t.person.isFollowing=e}):e.follow(n._id).then(function(e){t.person.isFollowing=e})}}}}]).directive("question",function(){return{restrict:"E",templateUrl:"assets/views/directives/question.htm",scope:{question:"="}}}).directive("familiarexpert",function(){return{restrict:"E",templateUrl:"assets/views/directives/familiar-expert.htm",scope:{user:"="}}}).directive("newquestions",["$rootScope",function(e){return{restrict:"E",templateUrl:"assets/views/directives/new-questions.htm",scope:{user:"="},link:function(t,n,o){t.questions=e.user.questions}}}]).directive("familiarexperts",["familiarExpertsService",function(e){return{restrict:"E",templateUrl:"assets/views/directives/familiar-experts.htm",link:function(t,n,o){t.users=[],t.familiarExpertsLoading=!0,e.get().then(function(e){t.users=e,t.familiarExpertsLoading=!1,t.$apply()})}}}]).directive("topbar",["$rootScope",function(e){return{restrict:"E",templateUrl:"assets/views/directives/topbar.htm",scope:{user:"="},link:function(t,n,o){t.openUserMenu=function(t){t.stopPropagation(),e.$broadcast("open-user-menu")}}}}]).directive("filters",function(){return{restrict:"E",templateUrl:"assets/views/directives/filters.htm"}}).directive("bigratedavatar",["$timeout","$rootScope",function(e,t){return{restrict:"E",templateUrl:"assets/views/directives/big-rated-avatar.htm",scope:{user:"=",onEdit:"="},link:function(n,o,r){"function"==typeof n.onEdit&&(n.editing=!0,n.chooseFile=function(t){var r=o[0].querySelector("input[type=file]");angular.element(r).on("change",function(e){e.stopImmediatePropagation(),n.$apply(function(){var t=e.target.files[0];n.onEdit(t)})}),e(function(){r.click(),e.cancel(this)},0)});var i=angular.element(o).find("canvas")[0],a=i.getContext("2d"),c=angular.element(o)[0].children[0].offsetWidth,u=angular.element(o)[0].children[0].offsetHeight;angular.element(o).find("canvas").attr("width",c),angular.element(o).find("canvas").attr("height",u);var s=4,l=t.user.xp/100*2+1.5;a.lineWidth=s,a.strokeStyle="#43abe7",a.beginPath(),a.arc(c/2,u/2,c/2-s/2,1.5*Math.PI,l*Math.PI,!1),a.stroke()}}}]).directive("autosuggest",function(){return{restrict:"E",templateUrl:"assets/views/directives/autosuggest.htm",scope:{suggestions:"=",ngModel:"=",viewTitle:"@"},link:function(e,t,n){e.show=!1;var o;e.$watch("ngModel",function(t,n){if(t&&t.title!=n.title&&n.title!=o){e.filteredSuggestions=[];for(var r=0;r<e.suggestions.length;r++){var i=e.suggestions[r];-1!==i.title.toLowerCase().indexOf(t.title.toLowerCase())&&e.filteredSuggestions.push(i)}e.filteredSuggestions=e.filteredSuggestions.slice(0,7),e.show=!0}else e.show=!1},!0),e.setSuggestion=function(t){o=e.ngModel.title,e.ngModel=t,e.show=!1}}}}).directive("lightbox",function(){return{restrict:"A",scope:{ngHref:"="},link:function(e,t,n){var o=window.location.origin+"/"+e.ngHref,r=angular.element(document.body);t.on("click",function(e){e.preventDefault();var t=angular.element('<div class="backdrop"></div>'),n=angular.element('<div class="image"></div>');n.css("backgroundImage","url("+o+")"),t.append(n),r.append(t);var i=function(e){t.remove({})};t.on("click",i),r.on("keydown",function(e){27==e.keyCode&&i()})})}}}).directive("pieces",["piecesService",function(e){return{restric:"E",templateUrl:"assets/views/directives/pieces.htm",link:function(t,n,o){e.get().then(function(e){t.pieces=e},function(){})}}}]).directive("profilecard",function(){return{restrict:"E",templateUrl:"assets/views/directives/profilecard.htm",scope:{user:"="},link:function(e,t,n){e.image=e.user.avatar||"/assets/images/avatar_placeholder.png"}}}).directive("followersicon",["$interval","$timeout","followService",function(e,t,n){return{restrict:"E",templateUrl:"assets/views/directives/followersicon.htm",scope:{user:"="},link:function(e,t,o){e.count=0,e.toggleFollow=function(e,t){t.stopImmediatePropagation(),e.isFollowing?n.unfollow(e._id).then(function(t){e.isFollowing=t}):n.follow(e._id).then(function(t){e.isFollowing=t})},angular.element(document.body).on("click",function(){e.showdropdown=!1,e.$apply()});var r=function(){n.followers(e.user._id).then(function(t){t=t.map(function(e){return e.role=e.role[0].toUpperCase()+e.role.substr(1),e}),e.count=t.length,e.followers=t})};r()}}}]).directive("notificationsicon",["$interval","notificationService",function(e,t){return{restrict:"E",templateUrl:"assets/views/directives/notificationsicon.htm",scope:{user:"="},link:function(n,o,r){n.count=0,angular.element(document.body).on("click",function(){n.showdropdown=!1,n.$apply()});var i=function(){t.get().then(function(e){n.count=e.length,n.notifications=e})},a=e(i,3e3);o.on("$destroy",function(){e.cancel(a)}),i()}}}]),angular.module("er.filters",[]).filter("tags",function(){return function(e){return e=e||"",e.replace(/#([a-z0-9]+)/gi,'<a href="#!/tag/$1" class="text-tag">#$1</a>')}}).filter("people",function(){return function(e){return e=e||"",e.replace(/@([a-z0-9]+)/gi,'<a href="#!/people/$1" class="text-people">@$1</a>')}}).filter("categories",function(){return function(e){return e=e||"",e.replace(/\$([a-z0-9]+)/gi,'<a href="#!/category/$1" class="text-category">$$$1</a>')}}).filter("textLinks",["$filter",function(e){return function(t){return t=t||"",t=e("tags")(t),t=e("people")(t),t=e("categories")(t)}}]),angular.module("er.modals",[]).factory("confirmPhoneModal",["btfModal",function(e){return e({controller:"confirmPhoneModalController",controllerAs:"modal",templateUrl:"assets/views/modals/confirm-account.htm"})}]).controller("confirmPhoneModalController",["$scope","$parent","$interval","phone","callback","confirmPhoneModal","verifyPhoneService","verifyPhoneCodeService",function(e,t,n,o,r,i,a,c){e.phone=o,e.maxResendTimerValue=30,e.errormessage="";var u=function(){e.resendTimer=e.maxResendTimerValue,e.errormessage="",e.ready=!1,e.loading=!0,a(o).then(function(){e.ready=!0,e.loading=!1,n(function(){e.resendTimer--},1e3,e.maxResendTimerValue)},function(t){e.ready=!0,e.loading=!1,e.errormessage=t,console.log(t)})};u(),e.close=function(){i.deactivate(),r(!1)},e.resend=function(){0==e.resendTimer&&u()},e.confirm=function(){return e.code?(e.loading=!0,void c(o,e.code).then(function(t){e.loading=!1,i.deactivate(),r(!0),console.log(t)},function(t){e.loading=!1,e.codeError=!0,console.log(t)})):e.codeError=!0}}]).factory("confirmAccountModal",["btfModal",function(e){return e({controller:"confirmAccountModalController",controllerAs:"modal",templateUrl:"assets/views/modals/confirm-account.htm"})}]).controller("confirmAccountModalController",["$scope","$parent","$interval","phone","confirmAccountModal","verifyPhoneService","verifyPhoneCodeService",function(e,t,n,o,r,i,a){e.phone=o,e.maxResendTimerValue=30;var c=function(){e.resendTimer=e.maxResendTimerValue,e.ready=!1,e.loading=!0,i(o).then(function(){e.ready=!0,e.loading=!1,n(function(){e.resendTimer--},1e3,e.maxResendTimerValue)})};c(),e.close=function(){r.deactivate(),t.doneSignup(!1)},e.resend=function(){0==e.resendTimer&&c()},e.confirm=function(){return e.code?(e.loading=!0,void a(o,e.code).then(function(n){e.loading=!1,r.deactivate(),t.doneSignup(!0),console.log(n)},function(t){e.loading=!1,e.codeError=!0,console.log(t)})):e.codeError=!0}}]).factory("forgotPasswordModal",["btfModal",function(e){return e({controller:"forgotPasswordModalController",controllerAs:"modal",templateUrl:"assets/views/modals/forgot-password.htm"})}]).controller("forgotPasswordModalController",["$scope","$parent","forgotPasswordModal","forgotPasswordService",function(e,t,n,o){e.close=n.deactivate,e.confirm=function(){return e.emailError=!1,e.email?(e.loading=!0,void o(e.email).then(function(t){e.loading=!1,e.sent=!0},function(t){e.loading=!1,e.error=t})):e.emailError=!0}}]).factory("findMyAccountModal",["btfModal",function(e){return e({controller:"findMyAccountModalController",controllerAs:"modal",templateUrl:"assets/views/modals/find-my-account.htm"})}]).controller("findMyAccountModalController",["$scope","$parent","$location","findMyAccountModal","findAccountRequestService","findAccountSigninService",function(e,t,n,o,r,i){e.close=o.deactivate,e.confirm=function(){return e.error="",e.inputError=!1,e.input?(e.requestLoading=!0,void r(e.input).then(function(t){e.requestLoading=!1,e.codeSent=!0},function(t){e.requestLoading=!1,e.error=t,console.error(t)})):e.inputError=!0},e.signIn=function(){return e.codeValidationError="",e.codeError=!1,e.code?(e.codeLoading=!0,void i(e.code).then(function(t){e.codeLoading=!1,n.url("/"),window.localStorage.satellizer_token=t.token,o.deactivate()},function(t){e.codeLoading=!1,e.codeValidationError=t})):e.codeError=!0}}]),angular.module("er.services",[]).factory("findAccountRequestService",["$http","$q",function(e,t){return function(n){var o=t.defer();return e.post("/auth/findaccount/request",{value:n}).then(function(e){o.resolve(e.data)},function(e){o.reject(e.data.message)}),o.promise}}]).factory("findAccountSigninService",["$http","$q",function(e,t){return function(n){var o=t.defer();return e.post("/auth/findaccount/signin",{code:n}).then(function(e){o.resolve(e.data)},function(e){o.reject(e.data.message)}),o.promise}}]).factory("forgotPasswordService",["$http","$q",function(e,t){return function(n){var o=t.defer();return e.post("/auth/forgotpassword",{email:n}).then(function(e){o.resolve(e.data)},function(e){o.reject(e.data.message)}),o.promise}}]).factory("checkPasswordTokenService",["$http","$q",function(e,t){return function(n){var o=t.defer();return e.post("/auth/forgotpassword/validate",{token:n}).then(function(e){o.resolve(e.data)},function(e){o.reject(e.data.message)}),o.promise}}]).factory("resetPasswordService",["$http","$q",function(e,t){return function(n,o){var r=t.defer();return e.post("/auth/resetpassword",{token:n,newpassword:o}).then(function(e){r.resolve(e.data)},function(e){r.reject(e.data.message)}),r.promise}}]).factory("validateEmailService",["$http","$q",function(e,t){return function(n){var o=t.defer();return e.post("/auth/signup/validate/email",{email:n}).then(function(e){o.resolve(e.data)},function(e){o.reject(e.data.message)}),o.promise}}]).factory("validatePhoneService",["$http","$q",function(e,t){return function(n){var o=t.defer();return e.post("/auth/signup/validate/phone",{phone:n}).then(function(e){o.resolve(e.data)},function(e){o.reject(e.data.message)}),o.promise}}]).factory("verifyPhoneService",["$http","$q",function(e,t){return function(n){var o=t.defer();return e.post("/auth/signup/verify/phone",{phone:n}).then(function(e){o.resolve(e.data)},function(e){o.reject(e.data.message)}),o.promise}}]).factory("verifyPhoneCodeService",["$http","$q",function(e,t){return function(n,o){var r=t.defer();return e.post("/auth/signup/verifycode/phone",{phone:n,code:o}).then(function(e){r.resolve(e.data)},function(e){r.reject(e.data.message)}),r.promise}}]).factory("countriesListService",["$http","$q",function(e,t){return function(){var n=t.defer();return e.get("/static/countries").then(function(e){n.resolve(e.data)}),n.promise}}]).factory("fieldsListService",["$http",function(e){return{get:function(){return e({method:"GET",url:"/static/categories"}).then(function(e){return e.data},function(e){return e})}}}]).factory("updateProfileService",["$http","$cookies",function(e,t){return function(n,o,r,i,a){return new Promise(function(c,u){e({method:"POST",url:"/profile/edit/profile",data:{token:t.get("token"),contact:n,experience:o,intro:r,name:i,position:a}}).success(function(e){c(e)}).error(function(e,t){u(e)})})}}]).factory("identityService",["$http","$cookies","$auth","$q","$rootScope",function(e,t,n,o,r){var i=void 0;return{otherCache:{},getOther:function(o){return e({method:"GET",url:"/user",headers:{Authorization:"Bearer "+(n.getToken()||t.get("token"))},params:{id:o}}).then(function(e){var t=e.data;return t.rating=t.rating||1,t.color=t.color||"bronze",t.likes=t.likes||0,t.xp=t.xp||0,t.dislikes=t.dislikes||0,t.reactions=t.reactions||0,t.followers=t.followers||0,t.following=t.following||0,t.avatar=t.avatar||"/assets/images/avatar_placeholder.png",t.role=t.role.charAt(0).toUpperCase()+t.role.slice(1),t.contact=t.contact||{email:"",phone:"",skype:"",linkedin:"",fb:""},t},function(e,t){return e})},_user:{},get:function(r){var a=o.defer();
return!i||void 0!==r&&r!==!1?e({method:"GET",url:"/me",headers:{Authorization:"Bearer "+(n.getToken()||t.get("token"))}}).then(function(e){var o=e.data;return o.rating=o.rating||1,o.color=o.color||"bronze",o.xp=o.xp||0,o.followers=o.followers||0,o.following=o.following||0,o.avatar=o.avatar||"/assets/images/avatar_placeholder.png",o.role=o.role.charAt(0).toUpperCase()+o.role.slice(1),o.contact=o.contact||{email:"",phone:"",skype:"",linkedin:"",fb:""},i=o,localStorage.rememberLogin&&"false"!=localStorage.rememberLogin,t.put("token",n.getToken()),a.resolve(o),o},function(e){return a.reject(e.message),e}):a.resolve(i),a.promise},clean:function(){i=void 0,this.otherCache={}},updateSettings:function(o){return e({method:"POST",url:"/profile/edit/settings",headers:{Authorization:"Bearer "+(n.getToken()||t.get("token"))},data:o}).then(function(e){return e.data},function(e){return e})},isPasswordValid:function(o){return e({method:"POST",url:"/profile/settings/isPasswordValid",headers:{Authorization:"Bearer "+(n.getToken()||t.get("token"))},data:{password:o}}).then(function(e){return e.data.valid},function(e){return e})},updatePassword:function(o,r){return e({method:"POST",url:"/profile/settings/setPassword",headers:{Authorization:"Bearer "+(n.getToken()||t.get("token"))},data:{oldPassword:o,newPassword:r}}).then(function(e){return e.data},function(e){return e})},disconnectSocial:function(o){return e({method:"POST",url:"/profile/settings/disconnectsocial",headers:{Authorization:"Bearer "+(n.getToken()||t.get("token"))},data:{provider:o}}).then(function(e){return e.data},function(e){return e})},updateNotifications:function(o){return e({method:"POST",url:"/profile/settings/notifications",headers:{Authorization:"Bearer "+(n.getToken()||t.get("token"))},data:o}).then(function(e){return e.data},function(e){return e})}}}]).factory("uploadAvatarService",["$http","$cookies",function(e,t){return function(n){return new Promise(function(o,r){var i=new FormData;i.append("file",n),i.append("token",t.get("token")),e({method:"POST",url:"/profile/edit/avatar",headers:{"Content-Type":void 0},data:i}).success(function(e){o(e)}).error(function(e,t){r(e)})})}}]).factory("uploadWallpaperService",["$http","$cookies",function(e,t){return function(n){return new Promise(function(o,r){var i=new FormData;i.append("file",n),i.append("token",t.get("token")),e({method:"POST",url:"/profile/edit/wallpaper",headers:{"Content-Type":void 0},data:i}).success(function(e){o(e)}).error(function(e,t){r(e)})})}}]).factory("certificatesService",["$http","$cookies",function(e,t){return{add:function(n){return new Promise(function(o,r){var i=new FormData;i.append("token",t.get("token")),i.append("file",n),e({method:"POST",url:"/profile/edit/addcertificate",headers:{"Content-Type":void 0},data:i}).success(function(e){o(e)}).error(function(e,t){r(e)})})},remove:function(n){return new Promise(function(o,r){e({method:"POST",url:"/profile/edit/removecertificate",data:{filename:n.filename,token:t.get("token")}}).success(o).error(function(e,t){r(e)})})}}}]).factory("downloadsService",["$http","$cookies",function(e,t){return{add:function(n){return new Promise(function(o,r){var i=new FormData;i.append("token",t.get("token")),i.append("file",n),e({method:"POST",url:"/profile/edit/adddownload",headers:{"Content-Type":void 0},data:i}).success(function(e){o(e)}).error(function(e,t){r(e)})})},remove:function(n){return new Promise(function(o,r){e({method:"POST",url:"/profile/edit/removedownload",data:{filename:n.filename,token:t.get("token")}}).success(o).error(function(e,t){r(e)})})}}}]).factory("feedService",["$sce","$http","$cookies",function(e,t,n){return{all:function(e,o){var r={};return void 0!=e&&(r.category=e),void 0!=o&&(r.country=o),t({method:"GET",url:"/article/all",cache:!1,headers:{Authorization:n.get("token")||"guest"},params:r}).then(function(e){var t=e.data;return t},function(e,t){return e})},my:function(){return t({method:"GET",url:"/article/my",cache:!1,headers:{Authorization:n.get("token")}}).then(function(e){return e.data},function(e,t){return e})},feed:function(e,o,r){var i={};return r&&(i.userId=r),t({method:"GET",url:"/article/feed?r="+Math.random(),cache:!1,headers:{Authorization:n.get("token")},params:i}).then(function(e){var t=e.data;return t},function(e,t){return e})},reacted:function(e,o){return t({method:"GET",url:"/article/feed/"+o,cache:!1,headers:{Authorization:n.get("token")},params:{user:e}}).then(function(e){return e.data},function(e,t){return e})}}}]).factory("postService",["$http","$cookies","$timeout",function(e,t,n){return{create:function(n,o){return new Promise(function(r,i){var a={Authorization:t.get("token")};if(o.length>0){var c=new FormData;c.append("text",n);for(var u in o)c.append("files",o[u]);a["Content-Type"]=void 0}else c={text:n};e({method:"POST",url:"/article/create",headers:a,uploadEventHandlers:{progress:function(e){}},data:c}).success(function(e){r(e)}).error(function(e,t){i(e)})})},remove:function(n){return e({method:"POST",url:"/article/remove",headers:{Authorization:t.get("token")},data:{article:n}}).then(function(e){return e.data},function(e){return e})},queue:[],delay:1e3,timer:void 0,getComments:function(o){var r,i,a=new Promise(function(e,t){r=e,i=t}).then(function(e){return e},function(e,t){return e});return this.queue.push({postId:o,promise:a,resolve:r,reject:i}),n.cancel(this.timer),this.timer=n(function(n){var o=[];for(var r in n.queue){var i=n.queue[r];o.push(i.postId)}return e({method:"GET",url:"/article/comment/get/few",headers:{Authorization:t.get("token")},params:{postIds:o.join(",")}}).then(function(e){var t=e.data;for(var o in t){var r=t[o];for(var i in n.queue)n.queue[i].postId==o&&n.queue[i].resolve(r)}},function(e,t){return e})},this.delay,!1,this),a},getCommentsImmediate:function(n){return e({method:"GET",url:"/article/comment/get",cache:!1,headers:{Authorization:t.get("token")},params:{postId:n}}).then(function(e){return e.data},function(e,t){return e})}}}]).factory("commentService",["$http","$cookies",function(e,t){return{add:function(n,o,r){var i={Authorization:t.get("token")};if(r.length>0){var a=new FormData;a.append("postId",n),a.append("text",o);for(var c in r)a.append("files",r[c]);i["Content-Type"]=void 0}else var a={postId:n,text:o};return e({method:"POST",url:"/article/comment/add",headers:i,data:a}).then(function(e){return e},function(e,t){return e})}}}]).factory("reactionsService",["$http","$cookies","$timeout",function(e,t,n){return{queue:[],delay:500,timer:void 0,get:function(o){var r,i,a=new Promise(function(e,t){r=e,i=t}).then(function(e){return e},function(e,t){return e});return this.queue.push({postId:o,promise:a,resolve:r,reject:i}),n.cancel(this.timer),this.timer=n(function(n){var o=[];for(var r in n.queue){var i=n.queue[r];o.push(i.postId)}return e({method:"GET",url:"/article/reactions/few",headers:{Authorization:t.get("token")},params:{postIds:o.join(",")}}).then(function(e){var t=e.data;for(var o in t){var r=t[o];for(var i in n.queue)n.queue[i].postId==o&&n.queue[i].resolve(r)}},function(e,t){return e})},this.delay,!1,this),a},getImmediate:function(n){return e({method:"GET",url:"/article/reactions",headers:{Authorization:t.get("token")},params:{post:n}}).then(function(e){return e.data},function(e,t){return e})},react:function(n,o){return e({method:"POST",url:"/article/react",headers:{Authorization:t.get("token")},data:{post:n,type:o}}).then(function(e){return e},function(e,t){return e})},unreact:function(n,o){return e({method:"DELETE",url:"/article/react",headers:{Authorization:t.get("token")},params:{post:n,type:o}}).then(function(e){return e},function(e,t){return e})}}}]).factory("followService",["$http","$cookies","identityService",function(e,t,n){return{isFollowing:function(n){return e({method:"GET",url:"/follow/isFollowing",headers:{Authorization:t.get("token")},params:{following:n}}).then(function(e){return e.data.isFollowing},function(e,t){return e})},follow:function(n){return e({method:"POST",url:"/follow/follow",headers:{Authorization:t.get("token")},data:{following:n}}).then(function(e){return e.data.isFollowing},function(e,t){return e})},unfollow:function(n){return e({method:"POST",url:"/follow/unfollow",headers:{Authorization:t.get("token")},data:{following:n}}).then(function(e){return e.data.isFollowing},function(e,t){return e})},following:function(n){return e({method:"GET",url:"/follow/following",headers:{Authorization:t.get("token")},params:{follower:n}}).then(function(e){return e.data.map(function(e){return e.following})},function(e,t){return e})},followers:function(n){return e({method:"GET",url:"/follow/followers",headers:{Authorization:t.get("token")},params:{following:n}}).then(function(e){return e.data.map(function(e){var t=e.follower;return Object.assign(t,{isFollowing:e.isFollowing}),t})},function(e,t){return e})}}}]).factory("piecesService",["$http","$cookies",function(e,t){return{get:function(){return e({method:"GET",url:"/article/pieces",headers:{Authorization:t.get("token")}}).then(function(e){return e.data},function(e,t){return e})}}}]).factory("commentReactionsService",["$http","$cookies","$timeout",function(e,t,n){return{queue:[],delay:500,timer:void 0,get:function(o){var r,i,a=new Promise(function(e,t){r=e,i=t}).then(function(e){return e},function(e,t){return e});return this.queue.push({commentId:o,promise:a,resolve:r,reject:i}),n.cancel(this.timer),this.timer=n(function(n){var o=[];for(var r in n.queue){var i=n.queue[r];o.push(i.commentId)}return e({method:"GET",url:"/article/comment/reactions/few",headers:{Authorization:t.get("token")},params:{commentIds:o.join(",")}}).then(function(e){var t=e.data;for(var o in t){var r=t[o];for(var i in n.queue)n.queue[i].commentId==o&&n.queue[i].resolve(r)}},function(e,t){return e})},this.delay,!1,this),a},getImmediate:function(n){return e({method:"GET",url:"/article/comment/reactions",headers:{Authorization:t.get("token")},params:{comment:commentId}}).then(function(e){return e.data},function(e,t){return e})},react:function(n,o){return e({method:"POST",url:"/article/comment/react",headers:{Authorization:t.get("token")},data:{comment:n,type:o}}).then(function(e){return e},function(e,t){return e})},unreact:function(n,o){return e({method:"DELETE",url:"/article/comment/react",headers:{Authorization:t.get("token")},params:{comment:n,type:o}}).then(function(e){return e},function(e,t){return e})}}}]).factory("familiarExpertsService",function(){return{get:function(){return new Promise(function(e,t){var n=[{id:1,name:"Keanu Reeves",role:"Expert",image:"https://s.aolcdn.com/hss/storage/midas/627f1d890718ff2c58318a280145a153/203216448/nicholas-cage-con-air.jpg",color:"bronze",rating:2,likes_percentage:70},{id:2,name:"Keanu Reeves",role:"Expert",image:"https://s.aolcdn.com/hss/storage/midas/627f1d890718ff2c58318a280145a153/203216448/nicholas-cage-con-air.jpg",color:"bronze",rating:2,likes_percentage:70},{id:3,name:"Keanu Reeves",role:"Expert",image:"https://s.aolcdn.com/hss/storage/midas/627f1d890718ff2c58318a280145a153/203216448/nicholas-cage-con-air.jpg",color:"bronze",rating:2,likes_percentage:70}];e(n)})}}}).factory("categoriesService",["$http","$q",function(e,t){return function(e){var n=t.defer(),o=[{id:1,title:"World News",count:353478392},{id:2,title:"Canada News",count:12478392},{id:3,title:"Buzz News",count:4478392},{id:4,title:"Science",count:2478392},{id:5,title:"Business",count:532952},{id:6,title:"Health",count:422321},{id:7,title:"Technology",count:352210},{id:8,title:"Sport",count:24990},{id:9,title:"Entertainment",count:1224}];return n.resolve(o),n.promise}}]).factory("groupedCountriesService",["$http","$q",function(e,t){return{get:function(){return e({method:"GET",url:"/static/countries/grouped"}).then(function(e){return e.data},function(e,t){return e})}}}]).factory("notificationService",["$http","$cookies",function(e,t){return{list:[],get:function(){var n=this;return e({method:"GET",url:"/n/get?r="+Math.random(),headers:{Authorization:t.get("token")}}).then(function(e){return n.list=e.data,e.data},function(e,t){return e})}}}]),angular.module("er.validators",[]).directive("email");